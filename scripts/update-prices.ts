/**
 * Script to update product prices from CSV data
 * Run with: DATABASE_URL="your-connection-string" npx tsx scripts/update-prices.ts
 */

import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

// Price data from CSV: Item Name -> New Selling Price
const priceUpdates: Record<string, number> = {
  "HIKSEMI 8GB DDR4 3200 LODIMM": 2934.0,
  "PATRIOT 8GB DDR4 3200 LODIMM": 2484.0,
  "PNY 16GB DDR4 3200 LODIMM": 6192.0,
  "GSKILL TRIDENTZ NEO 16GB DDR4 3600 LODIMM": 7560.0,
  "TFORCE VULCAN 8GB DDR4 3600 LODIMM": 3204.0,
  "GSKILL TRIDENTZ NEO 16GB DDR4 4000 LODIMM": 10656.0,
  "ADATA 8GB DDR5 4800 LODIMM": 3816.0,
  "ADATA 16GB DDR5 5600 LODIMM 1.1V": 8982.0,
  "VIPER 32GB DDR5 6000 LODDIMM": 17136.0,
  "VIPER 32GB DDR5 6200 LODIMM": 17712.0,
  "KINGSTON KVR24S17S8/8 8GB DDR4 2400 SODIMM": 4158.0,
  "KINGSTON HYPERX 8GB DDR4 2666 SODIMM": 6282.0,
  "KINGSTON VALUE 16GB DDR4 2666 SODIMM": 7632.0,
  "NETAC 8GB DDR4 2666 SODIMM": 3204.0,
  "HIKSEMI 16GB DDR4 3200 SODIMM": 4320.0,
  "HIKSEMI 8GB DDR4 3200 SODIMM": 2484.0,
  "KINGSTON VALUE 8GB DDR4 3200 SODIMM": 4032.0,
  "PATRIOT 16GB DDR4 3200 SODIMM": 5130.0,
  "ADATA 32GB DDR5 4800 SODIMM": 10026.0,
  "ADATA 16GB DDR5 5600 SODIMM 1.1V": 11610.0,
  "KINGSTON VALUE 8GB DDR5 5600 SODIMM": 4896.0,
  "TEAM GROUP 16GB DDR5 5600 SODIMM": 6390.0,
  "HIKVISION MICROSDHD CARD 32GB": 324.0,
  "SANDISK GAMEPLAY 128GB MICRO-SD SDSQXAA-128G-GN6XN": 1350.0,
  "SANDISK ULTRA MICROSDHC UHS-I CARD 32GB SDSQUA4-032G-GN6MN": 558.0,
  "SANDISK ULTRA MICROSDHC UHS-I CARD 16GB SDSQUAR-016G-GN6MN": 387.0,
  "TRANSCEND MICROSDHC UHS-I CARD WITH ADAPTER 350V 128GB TS128GUSD350V": 1674.0,
  "TRANSCEND ULTRA MICROSDHC UHS-I CARD 64GB 340S TS64GUSD340S": 1170.0,
  "SANDISK EXTREME PRO 32GB SDSQXCG-032G-GN6MA": 837.0,
  "SANDISK EXTREME 32GB MICROSDHC SDSQXAF-032G-GN5MN": 684.0,
  "TRANSCEND MICROSDHC UHS-I CARD WITH ADAPTER 300S 128GB TS128GUSD300S-A": 1206.0,
  "TRANSCEND MICROSDHC UHS-I CARD WITH ADAPTER 300S 64GB TS64GUSD300S-A": 675.0,
  "TRANSCEND MICROSDHC UHS-I CARD WITH ADAPTER 300S 32GB TS32GUSD300S-A": 522.0,
  "TRANSCEND MICROSDHC UHS-I CARD WITH ADAPTER 340S 128GB TS128GUSD340S-A": 1890.0,
  "SANDISK EXTREME MICROSDXC 128GB SDSQXAA-128G-GN6MN": 1602.0,
  "SANDISK HIGH ENDURANCE MSDXC 64GB SDSQQNR-064G-GN6IA": 954.0,
  "SANDISK EXTREME MICROSDXC UHS-I CARD 64GB SDSQXAH-064G-GN6MN": 882.0,
  "SANDISK EXTREME PRO MICROSDXC UHS-I CARD WITH ADAPTER 128GB SDSQXCD-128G-GN6MA": 1746.0,
  "SANDISK HIGH ENDURANCE MICROSDXC 512GB SDSQQNR-512G-GNGIA": 4770.0,
  "SANDIS ULTRA 64GB MICROSDXC SDSQUAB-064G-GN6MN": 576.0,
  "SANDISK EXTREME PRO MICROSDXC UHS-I WITH ADAPTER 64GB SDSQXCU-064G-GN6MA": 990.0,
  "SANDISK MAX ENDURANCE 128GB SDSQQVR-128G-GN6IA": 3150.0,
  "TRANSCEND MICROSDXC UHS-I CARD WITH ADAPTER 256GB 300S TS256GUSD300S-A": 2970.0,
  "TRANSCEND SD CARD UHS-I CARD 128GB TS128GSDC340S": 1890.0,
  "TRANSCEND SDXC UHS-I CARD 128GB 300S TS128GSDC300S": 738.0,
  "TRANSCEND SDHS UHS-I CARD 64GB 340S TS64GSDC340S": 1206.0,
  "TRANSCEND SDHC UHS-I CARD 32GB 300S TS32GSDC300S": 702.0,
  "SANDISK EXTREME PRO SDXC UHS-I CARD 256GB SDSDXXD-256G-GN4IN": 4410.0,
  "TRANSCEND SDXC UHS-I CARD 300S 64GB TS64GSDC300S": 891.0,
  "HIKSEMI 1TB 2.5 SSD": 6930.0,
  "WD 1TB 2.5 SSD": 7362.0,
  "HIKSEMI 256GB 2.5 SSD": 2610.0,
  "ADATA 512GB 2.5 SSD": 3744.0,
  "HIKSEMI 512GB 2.5 SSD": 3582.0,
  "PATRIOT 512GB 2.5 SSD": 4824.0,
  "TRANSCEND ESD310C 128GB OTG TYPE C EXTERNAL SSD": 2574.0,
  "ADATA SC610 1TB EXTERNAL SSD": 7686.0,
  "HIKSEMI HS-ESSD T300S PORTABLE SSD 1TB TYPE C": 7884.0,
  "KINGSTON XS1000 1TB EXTERNAL SSD": 9522.0,
  "TRANSCEND ESD380C 1TB EXTERNAL SSD": 13590.0,
  "TRANSCEND ESD270C 1TB EXTERNAL SSD TYPE C USB 3.1 GEN 2": 9324.0,
  "HIKSEMI HS-ESSD T300S PORTABLE SSD 2TB TYPE C": 16038.0,
  "TRANSCEND ESD270C 500GB EXTERNAL SSD TYPE C USB 3.1 GEN 2": 6030.0,
  "ADATA SC610 500GB EXTERNAL SSD": 5544.0,
  "TRANSCEND ESD310C 512GB EXTERNAL SSD": 7758.0,
  "TRANSCEND ESD380C 500GB EXTERNAL SSD": 7758.0,
  "TRANSCEND ESD300C 512GB EXTERNAL SSD TYPE C": 6030.0,
  "TRANSCEND ESD300S 512GB EXTERNAL SSD TYPE C": 6030.0,
  "RAMSTA 128GB M.2 NVME SSD": 3222.0,
  "HIKSEMI 1TB M.2 NVME SSD GEN4": 7686.0,
  "PATRIOT 256GB M.2 NVME SSD": 3276.0,
  "HIKSEMI 512GB M.2 NVME SSD GEN3": 4464.0,
  "HIKSEMI 512GB M.2 NVME SSD GEN4": 5166.0,
  "WD BLUE 500GB M.2 NVME SSD": 4824.0,
  "SANDISK OTG 64GB SDDD3-064G-G464W": 666.0,
  "SANDISK OTG 128GB SDDD3-128G-G46": 1188.0,
  "SANDISK ULTRA DUAL DRIVE 32GB USB MINI 3.0 SDDD3-032G-G46": 738.0,
  "SANDISK OTG DUAL DRIVE 64GB": 828.0,
  "SANDISK PHONE DRIVE 128GB TYPE C SDDDC6-128G-G46": 1314.0,
  "SANDISK SDDDC3-032G-G46 32GB ULTRA DUAL DRIVE GO TYPE C": 540.0,
  "TRANSCEND JF890 64GB OTG TYPE C": 1764.0,
  "TRANSCEND JF890 32GB OTG TYPE C USB 3.1": 1548.0,
  "TRANSCEND JF790C 128G OTG TYPE C": 1188.0,
  "DAHUA 16GB USB 2.0 DHI-U116-20-16GB": 342.0,
  "SANDISK CRUZER BLADE 64GB USB 2.0 SDCZ50-064G-B35": 666.0,
  "SANDISK CRUZER BLADE 32GB USB 2.0 SDCZ50C-032G-B35BE": 468.0,
  "SANDISK CRUZER BLADE 32GB USB 2.0 SDCZ50C-032G-B35PE": 468.0,
  "TRANSCEND JF590 32GB USB 2.0 TS32GJF590K": 558.0,
  "TRANSCEND JF590 64GB 2.0 TS64GJF590K": 738.0,
  "TRANSCEND JF350 64GB 2.0": 720.0,
  "TRANSCEND JF350 32GB USB 2.0 TS32GJF350": 558.0,
  "HIKSEMI HS-USB-M200 32GB USB 3.0": 450.0,
  "HIKSEMI HS-USB-M200 128GB USB 3.0": 1044.0,
  "HIKSEMI HS-USB-M220P 128GB USB 3.0": 1044.0,
  "HIKSEMI HS-USB-M220P 32GB USB 3.0": 486.0,
  "HIKSEMI HS-USB-M220P 64GB USB 3.2": 738.0,
  "HIKSEMI HS-USB-M200 64GB USB 3.0": 630.0,
  "HIKSEMI HS-USB-M200S 32GB USB 3.0": 486.0,
  "SANDISK ULTRA SHIFT 128GB USB 3.1 SDCZ410-128G-G46": 1044.0,
  "SANDISK IXPAND LUXE 128GB USB 3.0 SDIX70N-128G-GN6NE": 5022.0,
  "SANDISK ULTRA FIT 32GB 3.1": 738.0,
  "SANDISK CRUZER ULTRA 3.0 128GB, SDCZ48-128G-U46": 1278.0,
  "SANDISK ULTRA FIT 64GB 3.1": 756.0,
  "SANDISK ULTRA LUXE 64GB USB 3.0 SDCZ74-064G-G46": 864.0,
  "SANDISK ULTRA LUXE 128GB USB 3.2 GEN 1 SDCZ74-128G-G46": 1314.0,
  "SANDISK CRUZER ULTRA FLAIR 16GB 3.0 SDCZ73-016G-G46": 576.0,
  "SANDISK CRUZER ULTRA 3.0 64GB SDCZ48-064G-U46": 594.0,
  "SANDISK CRUZER ULTRA FLAIR 64GB 3.0 SDCZ73-064G-G46": 594.0,
  "SANDISK SMURFS 64GB USB 3.2 GEN 1 SDCZIS-064G-G46": 1746.0,
  "SANDISK CRUZER ULTRA 3.0 32GB SDCZ48-032G-U46": 522.0,
  "TRANSCEND JF920 512GB USB 3.2 GEN 1 TS512GJF920": 5490.0,
  "TRANSCEND JF920 128GB USB 3.2 GEN 1 TS128GJF920": 2376.0,
  "TRANSCEND JF810 64GB 3.1": 1026.0,
  "TRANSCEND JF920 256GB USB 3.2 GEN 1 TS256GJF920": 3366.0,
  "TRANSCEND JF700 32GB USB 3.1": 666.0,
  "TRANSCEND JF730 128GB USB 3.1 GEN 1 TS128GJF730": 1080.0,
  "TRANSCEND JF730 64GB PEN DRIVE CLASSIC": 702.0,
  "TRANSCEND JF790 64GB 3.1": 882.0,
  "TRANSCEND JF790 32GB USB 3.1 GEN 1 TS32GJF790K": 666.0,
  "TRANSCEND JF700 64GB USB 3.1 GEN 1 TS64GJF700": 882.0,
  "TRANSCEND JF790 128GB USB 3.1 GEN 1 TS128GJF790K": 1080.0,
  "TRANSCEND JF730 32GB USB 3.1 GEN 1 TS32GJF730": 666.0,
  "SANDISK ULTRA TYPEC 128GB SDCZ450-128G-G46": 1404.0,
  "SANDISK ULTRA TYPEC 64GB SDCZ450-064G-G46": 918.0,
  "SANDISK ULTRA TYPEC 32GB SDCZ450-032G-G46": 792.0,
  "TRANSCEND JF790C 64GB OTG TYPE C": 1044.0,
}

async function main() {
  console.log('Starting price update...')
  console.log(`Total products to update: ${Object.keys(priceUpdates).length}`)

  // Get businessId 1 (or adjust as needed)
  const businessId = 1

  // Get all locations
  const locations = await prisma.businessLocation.findMany({
    where: { businessId },
    select: { id: true, name: true },
  })

  console.log(`Found ${locations.length} locations`)

  let updatedCount = 0
  let notFoundCount = 0
  const notFound: string[] = []

  for (const [itemName, newPrice] of Object.entries(priceUpdates)) {
    // Find product by name (case-insensitive)
    const product = await prisma.product.findFirst({
      where: {
        businessId,
        name: {
          equals: itemName,
          mode: 'insensitive',
        },
      },
      include: {
        variations: {
          select: { id: true },
        },
      },
    })

    if (!product) {
      notFoundCount++
      notFound.push(itemName)
      continue
    }

    // Update all variations for all locations
    for (const variation of product.variations) {
      for (const location of locations) {
        await prisma.variationLocationDetails.upsert({
          where: {
            productVariationId_locationId: {
              productVariationId: variation.id,
              locationId: location.id,
            },
          },
          update: {
            sellingPrice: newPrice,
            lastPriceUpdate: new Date(),
          },
          create: {
            productId: product.id,
            productVariationId: variation.id,
            locationId: location.id,
            qtyAvailable: 0,
            sellingPrice: newPrice,
            lastPriceUpdate: new Date(),
          },
        })
      }
    }

    updatedCount++
    console.log(`Updated: ${itemName} -> ${newPrice}`)
  }

  console.log('\n--- SUMMARY ---')
  console.log(`Updated: ${updatedCount} products`)
  console.log(`Not found: ${notFoundCount} products`)

  if (notFound.length > 0) {
    console.log('\nProducts not found in database:')
    notFound.forEach(name => console.log(`  - ${name}`))
  }

  console.log('\nPrice update complete!')
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
